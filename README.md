# Vista AI News Magazine

این مخزن نسخهٔ اولیهٔ عملیاتی «مجلهٔ خبری هوش مصنوعی ویستا» است که شامل صفحهٔ اصلی چندزبانه، صفحات جزئیات خبر، API جست‌وجو، RSS، Sitemap پویا و پایپلاین جمع‌آوری و ترجمهٔ خبر مطابق با سند محصول است. ساختار زیر بر پایهٔ Next.js 14، Prisma و Supabase Auth (در آینده) بنا شده و آمادهٔ توسعهٔ ماژول‌های تکمیلی مانند پنل مدیریت است.

## ساختار پروژه

```
root
├─ src/app/             # App Router و صفحات محلی‌سازی‌شده
├─ src/components/      # کامپوننت‌های UI (در آینده)
├─ src/lib/             # ماژول‌های کمکی (DB، i18n، env)
├─ prisma/              # schema.prisma و seed.ts
├─ public/              # دارایی‌های استاتیک (در آینده)
├─ .husky/              # هوک‌های Git
├─ package.json         # اسکریپت‌ها و وابستگی‌ها (pnpm)
└─ tailwind.config.ts   # پیکربندی TailwindCSS
```

## پیش‌نیازها

- Node.js 18 یا جدیدتر
- pnpm 8 یا جدیدتر (در فایل `package.json` به نسخهٔ توصیه‌شده اشاره شده است)
- پایگاه‌دادهٔ Postgres در دسترس

## راه‌اندازی محلی

```bash
pnpm install
pnpm prisma migrate dev --name init
pnpm prisma db seed
pnpm dev
```

پس از اجرای دستورات فوق برنامه روی آدرس `http://localhost:3000` در دسترس است. مسیر `/fa` نسخهٔ فارسی و `/en` نسخهٔ انگلیسی را نمایش می‌دهد. صفحهٔ اصلی شامل قهرمان، کارت خبرها، دسته‌های پرطرفدار و لینک به صفحات «درباره» و «تماس» است.

### جمع‌آوری و ترجمهٔ خودکار

برای اجرای دستی پایپلاین جمع‌آوری خبر:

```bash
pnpm ts-node src/jobs/index.ts
```

و یا از مسیر API محافظت‌شده استفاده کنید:

```bash
curl -X POST \
  -H "Authorization: Bearer $SUPABASE_SERVICE_ROLE_KEY" \
  http://localhost:3000/api/ingest/trigger
```

در صورت تعریف متغیر `LT_URL` (سرویس LibreTranslate یا معادل آن) متن‌های انگلیسی به‌صورت خودکار به فارسی ترجمه و در جدول `TranslationCache` ذخیره می‌شود.

## اسکریپت Seed

اجرای `pnpm prisma db seed` یک حساب مدیر (admin@vista-ai.ir) با گذرواژهٔ پیش‌فرض `Strong!Pass#123` ایجاد می‌کند و دسته‌بندی‌ها، برچسب‌ها و چند منبع خبری whitelisted را مقداردهی اولیه می‌کند. توصیه می‌شود پس از ورود اولین بار، گذرواژه را تغییر دهید.

## امکانات فعلی

- **صفحات چندزبانه:** مسیر `/[locale]` با `next-intl` پیاده‌سازی شده و ناوبری، هدر/فوتر، قهرمان صفحهٔ اصلی و محتوای صفحات «تماس» و «درباره» را بر اساس زبان تنظیم می‌کند.
- **جزئیات خبر:** مسیر `/[locale]/news/[slug]` متادیتای سئو، JSON-LD و لیست اخبار مرتبط را رندر می‌کند.
- **پایپلاین جمع‌آوری:** فایل `src/jobs/fetch-news.ts` اخبار را از RSS Allowlist خوانده، با `metascraper` نرمال‌سازی و تمیز می‌کند. ماژول `src/jobs/index.ts` آن‌ها را در پایگاه‌داده ذخیره کرده و با قواعد ساده دسته/برچسب می‌زند.
- **ترجمهٔ کش‌شونده:** ماژول `src/lib/translation/provider.ts` در صورت تنظیم LibreTranslate متون انگلیسی را به فارسی ترجمه و در جدول `TranslationCache` ذخیره می‌کند.
- **خروجی‌های سئو:** `src/app/rss.xml/route.ts`، `src/app/sitemap.ts` و `src/app/robots.txt/route.ts` به صورت پویا از داده‌های منتشرشده تولید می‌شوند.
- **جست‌وجوی زنده:** اندپوینت `GET /api/search` نتایج را بر اساس زبان و عبارت جست‌وجو برمی‌گرداند.

## مراحل بعدی پیشنهادی

- اتصال Supabase Auth برای نقش‌های Admin/Editor و محافظت از مسیر `/admin`.
- تکمیل پنل مدیریت، صف بازبینی و ویرایشگر محتوای دو زبانه.
- افزودن صف Job (pg-boss یا Upstash) برای هماهنگی کران‌های جمع‌آوری و بازسازی کش.
- پوشش تست‌های واحد و پایان‌به‌پایان برای طبقه‌بندی و ترجمه.

## مجوز

کد پروژه تحت مجوز اختصاصی شرکت شبکه هوشمند ابتکار ویستا توسعه می‌یابد؛ برای استفادهٔ مجدد حتماً هماهنگ شود.
